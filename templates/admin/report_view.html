{% extends "layouts/main_layout.html" %}

{% block title %}Review Report{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto;">
    <!-- Header Banner -->
    <div class="Controls" style="margin-top: 20px;">
        <div>
            <div class="Controls-title">R-0024 | Technical Issue</div>
            <div class="Controls-subtitle">Reported by User ID: A-0001 on Nov 03, 2025</div>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="button-secondary" onclick="window.location.href='reports.html'">Back</button>
            <button class="button-primary" onclick="saveResponse()">Save & Update</button>
        </div>
    </div>

    <!-- Report Details -->
    <div
        style="background: white; padding: 30px; border-radius: 10px; margin: 20px 0; box-shadow: 0px 1px 3px rgba(0,0,0,0.2);">
        <h3 class="subheadings">Report Details</h3>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
            <div>
                <div style="font-size: 14px; color: var(--navy); font-weight: 600; margin-bottom: 5px;">Report ID</div>
                <div style="font-size: 15px;">R-0024</div>
            </div>
            <div>
                <div style="font-size: 14px; color: var(--navy); font-weight: 600; margin-bottom: 5px;">Type</div>
                <div style="font-size: 15px;">Technical Issue</div>
            </div>
            <div>
                <div style="font-size: 14px; color: var(--navy); font-weight: 600; margin-bottom: 5px;">Sender</div>
                <div style="font-size: 15px;">User ID: A-0001</div>
            </div>
            <div>
                <div style="font-size: 14px; color: var(--navy); font-weight: 600; margin-bottom: 5px;">Date Reported
                </div>
                <div style="font-size: 15px;">Nov 03, 2025</div>
            </div>
            <div>
                <div style="font-size: 14px; color: var(--navy); font-weight: 600; margin-bottom: 5px;">Priority</div>
                <div style="font-size: 15px; color: #f9a826; font-weight: bold;">Medium</div>
            </div>
            <div>
                <div style="font-size: 14px; color: var(--navy); font-weight: 600; margin-bottom: 5px;">Current Status
                </div>
                <div><span class="status-badge status-pending">Open</span></div>
            </div>
        </div>

        <div style="margin-top: 25px;">
            <div style="font-size: 14px; color: var(--navy); font-weight: 600; margin-bottom: 8px;">Subject</div>
            <div style="font-size: 16px; color: var(--navy);">Predictive Model Not working</div>
        </div>

        <div style="margin-top: 20px;">
            <div style="font-size: 14px; color: var(--navy); font-weight: 600; margin-bottom: 8px;">Description</div>
            <div
                style="background: var(--whtish); padding: 15px; border-radius: 5px; border-left: 3px solid var(--light-blue); line-height: 1.6;">
                When attempting to run the predictive model for patient P-24501, the system returns an error message
                stating "Model initialization failed". This occurs consistently across multiple attempts. The issue
                started appearing after the system update on Nov 02, 2025. The error prevents physicians from generating
                risk assessments for new patients, impacting clinical workflow significantly.
                <br><br>
                <strong>Steps to Reproduce:</strong>
                <br>1. Navigate to patient profile
                <br>2. Click "Generate Risk Assessment"
                <br>3. Error appears after loading for approximately 30 seconds
                <br><br>
                <strong>Expected Behavior:</strong> Risk assessment should be generated and displayed within 5-10
                seconds.
            </div>
        </div>

        <div style="margin-top: 25px;">
            <div style="font-size: 14px; color: var(--navy); font-weight: 600; margin-bottom: 8px;">Update Status</div>
            <select id="statusSelect" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <option value="open" selected>Open</option>
                <option value="in_progress">In Progress</option>
                <option value="resolved">Resolved</option>
                <option value="closed">Closed</option>
            </select>
        </div>
    </div>

    <!-- Response Section -->
    <div
        style="background: white; padding: 30px; border-radius: 10px; margin: 20px 0; box-shadow: 0px 1px 3px rgba(0,0,0,0.2);">
        <h3 class="subheadings">Admin Response</h3>

        <div style="margin-top: 20px;">
            <div style="font-size: 14px; color: var(--navy); font-weight: 600; margin-bottom: 8px;">Response / Notes
            </div>
            <textarea id="responseText"
                style="width: 95%; min-height: 120px; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 14px; resize: vertical;"
                placeholder="Enter your response or notes regarding this report..."></textarea>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="button-secondary" onclick="window.location.href='reports.html'">Cancel</button>
            <button class="button-primary" onclick="saveResponse()">Send and Resolve</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}

<script>
    function saveResponse() {
        const status = document.getElementById('statusSelect').value;
        const response = document.getElementById('responseText').value;

        if (!response.trim()) {
            showAppDialog('Please enter a response or notes before saving.');
            return;
        }

        console.log('Saving:', { reportId: 'R-0024', status, response });
        showAppDialog('Report updated successfully!');
        window.location.href = 'reports.html';
    }
</script>
{% endblock %}